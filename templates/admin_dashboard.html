<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/static/admin.css">
</head>
<body>
    <div class="admin-container">
        <h1>Admin Dashboard</h1>
        
        <h2>Create New Event</h2>
        <form action="{{ url_for('new_event') }}" method="POST">
            <label for="name">Event Name:</label>
            <input type="text" id="name" name="name" required>
            <div id="nameValidation" class="validation-message" style="display: none;"></div>
            <div class="slug-preview">
                <small>URL will be: <strong>partymail.app/<span id="slugPreview"></span></strong></small>
            </div>

            <label for="date">Date:</label>
            <input type="text" id="date" name="date" required>
            <small class="help-text">Use one of these formats: November 15, 2024 | 2024-11-15 | 11/15/2024</small>
            
            <label for="time">Time:</label>
            <input type="text" id="time" name="time" required>
            <small class="help-text">Use one of these formats: 7:00 PM | 19:00 | 7:30 AM</small>
            
            <label for="location">Location:</label>
            <input type="text" id="location" name="location" required>
            
            <label for="description">Description:</label>
            <textarea id="description" name="description" required></textarea>
            
            <label for="max_guests_per_invite">Max Guests per Invite:</label>
            <input type="number" id="max_guests_per_invite" name="max_guests_per_invite" required>
            
            <button type="submit">Create Event</button>
        </form>

        <h2>Existing Events</h2>
        <ul>
            {% for slug, event in events.items() %}
                <li><a href="{{ url_for('admin', slug=event['slug']) }}">{{ event['name'] }} ({{ slug }})</a></li>
            {% endfor %}
        </ul>
        <a href="{{ url_for('admin_logout') }}">Logout</a>
    </div>

    <script>
        // Existing event names for validation
        const existingEventNames = [
            {% for slug, event in events.items() %}
                "{{ event['name'] | lower }}",
            {% endfor %}
        ];

        // Generate slug preview as user types
        function generateSlug(name) {
            // Convert to lowercase
            let slug = name.toLowerCase();

            // Remove accents (basic ASCII conversion)
            slug = slug.normalize('NFD').replace(/[\u0300-\u036f]/g, '');

            // Remove non-alphanumeric characters (keep spaces and hyphens)
            slug = slug.replace(/[^\w\s-]/g, '');

            // Replace multiple spaces/hyphens with single hyphen
            slug = slug.replace(/[-\s]+/g, '-');

            // Remove leading/trailing hyphens
            slug = slug.replace(/^-+|-+$/g, '');

            return slug;
        }

        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('name');
            const slugPreview = document.getElementById('slugPreview');
            const nameValidation = document.getElementById('nameValidation');
            const submitButton = document.querySelector('button[type="submit"]');

            nameInput.addEventListener('input', function() {
                const name = this.value.trim();
                const slug = generateSlug(name);
                slugPreview.textContent = slug || '...';

                // Check for empty name
                if (name === '') {
                    nameValidation.textContent = '';
                    nameValidation.style.display = 'none';
                    submitButton.disabled = false;
                }
                // Check for duplicate names
                else if (existingEventNames.includes(name.toLowerCase())) {
                    nameValidation.textContent = '⚠️ An event with this name already exists';
                    nameValidation.style.display = 'block';
                    nameValidation.className = 'validation-message error';
                    submitButton.disabled = true;
                } else {
                    nameValidation.textContent = '✓ Event name is available';
                    nameValidation.style.display = 'block';
                    nameValidation.className = 'validation-message success';
                    submitButton.disabled = false;
                }

                // Highlight if slug is very long
                if (slug.length > 40) {
                    slugPreview.style.color = '#ff6b6b';
                } else {
                    slugPreview.style.color = '';
                }
            });
        });
    </script>
</body>
</html>